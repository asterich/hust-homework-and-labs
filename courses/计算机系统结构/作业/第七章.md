##### 7.9

L1 cache 不命中率是110/3000 = 3.67%

L2 cache 局部不命中率是55/110 = 50%

L2 cache 全局不命中率是55/3000 = 1.83%



##### 7.10

平均访问时间＝命中时间＋失效率×失效开销
平均访问时间1-路=2.0+1.4% \* 80=3.12ns
平均访问时间2-路=2.0 \* (1+10%)+1.0% \* 80=3.0ns
两路组相联的平均访问时间比较低
CPUtime =（CPU执行+存储等待周期）\* 时钟周期
CPUtime = IC（CPI执行+总失效次数/指令总数 \* 失效开销）• CPU time=IC（CPI执行+总失效次数/指令总数 \* 失效开销）\*时钟周期
                    = IC（（CPI执行 \* 时钟周期）+（每条指令的访存次数 \* 失效率 \* 失效开销 \* 时钟周期））
CPU time 1-way=IC(2.0 \* 2+1.2 \* 0.014 \* 80)=5.344IC
CPU time 2-way=IC(2.2 \* 2+1.2 \* 0.01*80)=5.36IC
相对性能比：5.36/5.344=1.003
直接映象cache的访问速度比两路组相联cache要快1.04倍，而两路组相联Cache的平均性能比直接映象cache要高1.003倍。因此这里选择两路组相联。

##### 7.11

不管作了何种改进，失效开销相同。不管是否交换内容，在同一“伪相联”组中的两块都是用同一个索引得到的，因此失效率相同，即：
失效率(伪相联)=失效率(2路)。
伪相联cache的命中时间等于直接映象cache的命中时间加上伪相联查找过程中的命中时间 \* 该命中所需的额外开销。
命中时间(伪相联)＝命中时间(1路)＋伪命中率(伪相联)×1
交换或不交换内容，伪相联的命中率都是由于在第一次失效时，将地址取反，再在第二次查找带来的。
因此，伪命中率(伪相联)=命中率(2路)－命中率(1路)=（1-失效率(2路)）-（1-失效率(1路)）=失效率(1路)-失效率(2路)。交换内容需要增加伪相联的额外开销。
平均访存时间(伪相联)=命中时间(1路)+（失效率(1路)-失效率(2路)）×1-失效率(2路)×失效开销(1路)
将题设中的数据带入计算，得到：
平均访存时间(2KB)=1+(0.098-0.076)\*1+(0.076 \*50 ) =4.822
平均访存时间(128KB)=1+(0.010-0.007)*1+(0.007 *50 ) =1.353
显然是128KB的伪相联Cache要快一些。

##### 7.14

采用按写分配

1. 写直达cache访问命中，有两种情况：读命中，不访问主存；写命中，更新cache和主存，访问主存一次。

   访问失效，有两种情况：读失效，将主存中的块调入cache中，访问主存两次；写失效，将要写的块调入cache，访问主存两次，再将修改的数据写入cache和主存，访问主存一次，共三次。上述分析如下表所示。

   | 访问命中 | 访问类型 | 频率          | 访存次数 |
   | -------- | -------- | ------------- | -------- |
   | y        | 读       | 95%\*75%=71.3% | 0        |
   | y        | 写       | 95%\*25%=23.8% | 1        |
   | n        | 读       | 5%\*75%=3.8%   | 2        |
   | n        | 写       | 5%\*25%=1.3%   | 3        |

   一次访存请求最后真正的平均访存次数=(71.3%\*0)+(23.8%\*1)+(3.8%\*2)+(1.3%\*3)=0.35
   已用带宽=0.35×10^9/(10^9)=35.0%

2. 写回法cache访问命中，有两种情况：读命中，不访问主存；写命中，不访问主存。只有当修改的cache块被换出时才写入主存。访问失效,有一个块将被换出，这也有两种情况：如果被替换的块没有修改过，将主存中的块调入cache块中，访问主存两次；如果被替换的块修改过，则首先将修改的块写入主存，需要访问主存两次；然后将主存中的块调入cache块中，需要访问主存两次，共四次访问主存。

   | 访问命中 | 块为脏 | 频率          | 访存次数 |
   | -------- | ------ | ------------- | -------- |
   | y        | n      | 95%*70%=66.5% | 0        |
   | y        | y      | 95%*30%=28.5% | 0        |
   | n        | n      | 5%*70%=3.5%   | 2        |
   | n        | y      | 5%*30%=1.5%   | 4        |

   一次访存请求最后真正的平均访存次数=66.5％\*0＋28.5%\*0+3.5%\*2+1.5%\*4=0.13
   已用带宽＝0.13×10^9/(10^9)＝13%

